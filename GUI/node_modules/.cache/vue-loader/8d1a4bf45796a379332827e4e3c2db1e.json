{"remainingRequest":"/Users/womitowoju/workspace/aida/VERDI-UI/GUI/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/womitowoju/workspace/aida/VERDI-UI/GUI/src/views/eval/ClaimSearch.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/womitowoju/workspace/aida/VERDI-UI/GUI/src/views/eval/ClaimSearch.vue","mtime":1640207172536},{"path":"/Users/womitowoju/workspace/aida/VERDI-UI/GUI/node_modules/cache-loader/dist/cjs.js","mtime":1641411772188},{"path":"/Users/womitowoju/workspace/aida/VERDI-UI/GUI/node_modules/babel-loader/lib/index.js","mtime":1641411773354},{"path":"/Users/womitowoju/workspace/aida/VERDI-UI/GUI/node_modules/cache-loader/dist/cjs.js","mtime":1641411772188},{"path":"/Users/womitowoju/workspace/aida/VERDI-UI/GUI/node_modules/vue-loader/lib/index.js","mtime":1641411773606}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBBdXRvQ29tcGxldGUgZnJvbSAnQC9jb21wb25lbnRzL0F1dG9Db21wbGV0ZSc7CmltcG9ydCBDYXRlZ29yeVJvbGVGaWx0ZXIgZnJvbSAnQC9jb21wb25lbnRzL2Zvcm1zL0NhdGVnb3J5Um9sZUZpbHRlcic7CmltcG9ydCBTZWxlY3REcm9wZG93biBmcm9tICdAL2NvbXBvbmVudHMvU2VsZWN0RHJvcGRvd24nOwppbXBvcnQgQ2xhaW1zIGZyb20gJ0Avdmlld3MvYW5hbHl6ZS9DbGFpbXMnOwppbXBvcnQgQ2F0ZWdvcnlUeXBlcyBmcm9tICdAL2Fzc2V0cy9kYXRhL3R5cGVzLmpzb24nOwppbXBvcnQge21hcE11dGF0aW9uc30gZnJvbSAndnVleCc7CmltcG9ydCB7U0VMRUNURElTUExBWSwKICAgIFRBQkxFRklFTERNQVBQSU5HLAogICAgSU5DSURFTlRNQVBQSU5HLAogICAgZ2V0VHJhbnNmb3JtZWRUeXBlLAogICAgZ2V0TGFzdFN1YlR5cGUsCiAgICBnZXRSb2xlLAogICAgZ2V0SW5jaWRlbnRJZCwKICAgIHNvcnRDYXNlSW5zZW5zaXRpdmUKfSBmcm9tICcuLi8uLi91dGlscyc7CmltcG9ydCBBUEkgZnJvbSAnLi4vLi4vYXBpJzsKCmNvbnN0IENMQUlNRklMVEVSUyA9IHsKICAgIHBhcmVudEZpbHRlcjogJ2ZpbHRlcicsCiAgICBldmVudDogJ2V2ZW50RmlsdGVyJywKICAgIGVudGl0eTogJ2VudGl0eUZpbHRlcicsCiAgICBlbnRpdHlSb2xlOiAnZW50aXR5Um9sZUZpbHRlcicsCiAgICBldmVudFJvbGU6ICdldmVudFJvbGVGaWx0ZXInLAogICAgLy9zcGVjaWZpYyB0byBSZXN0IEFQSSBkYXRhIGZvcm1hdHRpbmcKICAgIGFyZ3VtZW50SWRzOiAnaWRzJywKICAgIHJvbGU6ICdyb2xlJywKICAgIGV2ZW50VHlwZTogJ2V2ZW50VHlwZScKfTsKCmNsYXNzIENhdGVnb3J5RGV0YWlscyB7CiAgICBjb25zdHJ1Y3RvciAocHJlcG9zaXRpb24sIGxhYmVsLCBtZXNzYWdlKSB7CiAgICAgICAgdGhpcy5wcmVwb3NpdGlvbiA9IHByZXBvc2l0aW9uOwogICAgICAgIHRoaXMubGFiZWwgPSBsYWJlbDsKICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgfQp9CgpjbGFzcyBWaWV3IHsKICAgIGNvbnN0cnVjdG9yICh0eXBlLCBkaXNhYmxlZCkgewogICAgICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGRpc2FibGVkOwogICAgfQp9CgpjbGFzcyBFdmVudEZpbHRlciB7CiAgICBjb25zdHJ1Y3RvcihpZCkgewogICAgICAgIHRoaXMuZmlsdGVySWQgPSBpZDsKICAgICAgICB0aGlzLmZpbHRlclR5cGUgPSBDTEFJTUZJTFRFUlMuZXZlbnQ7CiAgICAgICAgdGhpcy5ldmVudFR5cGUgPSBbXTsKICAgICAgICB0aGlzLmFyZ3VtZW50cyA9IHt9OwogICAgICAgIHRoaXMuY29uZGl0aW9uQ291bnQgPSAwOwogICAgICAgIHRoaXMubmFtZXMgPSB7fTsKICAgICAgICB0aGlzLnJvbGVzID0ge307CiAgICB9Cn0KCmNsYXNzIEVudGl0eUZpbHRlciB7CiAgICBjb25zdHJ1Y3RvcihpZCkgewogICAgICAgIHRoaXMuZmlsdGVySWQgPSBpZDsKICAgICAgICB0aGlzLmZpbHRlclR5cGUgPSBDTEFJTUZJTFRFUlMuZW50aXR5OwogICAgICAgIHRoaXMubmFtZWRFbnRpdHkgPSBbXTsKICAgICAgICB0aGlzLmFyZ3VtZW50cyA9IHt9OwogICAgICAgIHRoaXMuY29uZGl0aW9uQ291bnQgPSAwOwogICAgICAgIHRoaXMuZXZlbnRzID0ge307CiAgICAgICAgdGhpcy5yb2xlcyA9IHt9OwogICAgfQp9CgpmdW5jdGlvbiBpbml0aWFsU3RhdGUoKSB7CiAgICByZXR1cm4gewogICAgICAgIHNlbGVjdERpc3BsYXk6IFNFTEVDVERJU1BMQVkuaW5wdXQsCiAgICAgICAgc2VsZWN0ZWRTaW5JZDonRTIwMScsCiAgICAgICAgc2hvd1NlYXJjaEJ1dHRvbnM6IHRydWUsCiAgICAgICAgc2hvd0FkZFRvU2VhcmNoQnV0dG9uczogZmFsc2UsCiAgICAgICAgY2xhaW1GaWx0ZXJzOiB7fSwKICAgICAgICBmb3JtYXR0ZWRGaWx0ZXJzOiB7fSwKICAgICAgICBxdWVyeUtleTogMSwKICAgICAgICBxdWVyeUV2ZW50VHlwZXMgOiBbXSwKICAgICAgICBxdWVyeU5hbWVkRW50aXRpZXM6IFtdLAogICAgICAgIHJlc3VsdHNBbmNob3I6ICdjbGFpbV9yZXN1bHRzJywKICAgICAgICB2aWV3czogewogICAgICAgICAgICByZXNldFF1ZXJ5OiBuZXcgVmlldygncmVzZXRRdWVyeScsIGZhbHNlKSwKICAgICAgICAgICAgc3RhcnRRdWVyeTogbmV3IFZpZXcoJ3N0YXJ0UXVlcnknLCB0cnVlKSwKICAgICAgICAgICAgZXZlbnRRdWVyeTogbmV3IFZpZXcoJ2V2ZW50UXVlcnknLCB0cnVlKSwKICAgICAgICAgICAgbmFtZWRFbnRpdHlRdWVyeTogbmV3IFZpZXcoJ25hbWVkRW50aXR5UXVlcnknLCB0cnVlKSwKICAgICAgICAgICAgY2F0ZWdvcnlBZGRBcmd1bWVudCA6bmV3IFZpZXcoJ2NhdGVnb3J5QWRkQXJndW1lbnQnLCB0cnVlKSwKICAgICAgICAgICAgY2xhaW1SZXN1bHRzOiBuZXcgVmlldygnY2xhaW1SZXN1bHRzJywgdHJ1ZSkKICAgICAgICB9CiAgICB9Cn0KZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogJ0NsYWltU2VhcmNoJywKICAgIGNvbXBvbmVudHM6IHtBdXRvQ29tcGxldGUsIENsYWltcywgQ2F0ZWdvcnlSb2xlRmlsdGVyLCBTZWxlY3REcm9wZG93bn0sCiAgICBkYXRhOiAoKSA9PiAoaW5pdGlhbFN0YXRlKCkpLAogICAgY3JlYXRlZCgpIHsKICAgICAgICB0aGlzLkNMQUlNRklMVEVSUyA9IENMQUlNRklMVEVSUzsKICAgICAgICB0aGlzLklOQ0lERU5UTUFQUElORyA9IElOQ0lERU5UTUFQUElORzsKICAgIH0sCiAgICBtb3VudGVkKCkgewogICAgICAgIHdpbmRvdy5zY3JvbGwoewogICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJwogICAgICAgIH0pOwogICAgICAgIC8vZmV0Y2ggdGhlIHF1ZXJ5IGV2ZW50IHR5cGVzIGFuZCBuYW1lZCBlbnRpdGllcyBmb3IgdGhlIHNlbGVjdGVkIFNJTgogICAgICAgIHRoaXMuZ2V0RXZlbnRUeXBlcygpOwogICAgICAgIHRoaXMuZ2V0RW50aXR5TmFtZXMoKTsKICAgIH0sCiAgICBjb21wdXRlZDogewogICAgICAgZXZlbnRUeXBlcygpIHsKICAgICAgICAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1FdmVudFR5cGVzKHRoaXMucXVlcnlFdmVudFR5cGVzKTsKICAgICAgIH0sCiAgICAgICAgbmFtZWRFbnRpdGllcygpIHsKICAgICAgICAgICByZXR1cm4gdGhpcy5xdWVyeU5hbWVkRW50aXRpZXM7CiAgICAgICAgfSwKICAgICAgICBjb21wdXRlZENsYWltcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xhaW1GaWx0ZXJzOwogICAgICAgIH0sCiAgICAgICAgZm9ybWF0dGVkQ2xhaW1zKCkgewogICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdHRlZEZpbHRlcnM7CiAgICAgICAgfSwKICAgICAgICBzaW5JZHMoKSB7CiAgICAgICAgICAgIHJldHVybiBJTkNJREVOVE1BUFBJTkcubWFwKHYgPT4gdi52YWx1ZSk7CiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICAuLi5tYXBNdXRhdGlvbnMoWyd1cGRhdGVTaW5TZWxlY3Rpb24nXSksCiAgICAgICAgbGlua1RvRXZhbERvY1NlYXJjaCAoKSB7CiAgICAgICAgICAgIHdpbmRvdy5vcGVuKCdodHRwczovL2JsYWNrYm94LnZlcmRpLm5leHRjZW50dXJ5LmNvbS8nLCAnX2JsYW5rJyk7CiAgICAgICAgfSwKICAgICAgICBjb21wbGV0ZWRTZWFyY2godmFsdWUpIHsKICAgICAgICAgICAgdGhpcy4kcmVmcy5zZWFyY2hCdXR0b24uZGlzYWJsZWQgPSAhdmFsdWUKICAgICAgICB9LAogICAgICAgIGdldFByZXR0eUxhYmVscyhpdGVtcykgewogICAgICAgICAgICAvL3JlbW92ZSBkdXBsaWNhdGVzIGFuZCBzb3J0CiAgICAgICAgICAgcmV0dXJuICBPYmplY3Qua2V5cyhpdGVtcykgPyBzb3J0Q2FzZUluc2Vuc2l0aXZlKFsuLi5PYmplY3Qua2V5cyhpdGVtcyldKSA6IGl0ZW1zOwogICAgICAgIH0sCiAgICAgICAgdHJhbnNmb3JtRXZlbnRUeXBlcyhldmVudFR5cGVzKSB7CiAgICAgICAgICAgIGxldCB0eXBlcyA9IHt9OwogICAgICAgICAgICBmb3IgKGNvbnN0IHR5cGUgb2YgZXZlbnRUeXBlcykgewogICAgICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtZWRUeXBlID0gZ2V0VHJhbnNmb3JtZWRUeXBlKGdldExhc3RTdWJUeXBlKHR5cGUpLCBDYXRlZ29yeVR5cGVzLmV2ZW50VHlwZU1hcHBpbmcpOwogICAgICAgICAgICAgICAgaWYodHlwZXMuaGFzT3duUHJvcGVydHkodHJhbnNmb3JtZWRUeXBlKSkgewogICAgICAgICAgICAgICAgICAgIHR5cGVzW3RyYW5zZm9ybWVkVHlwZV0ucHVzaCh0eXBlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHR5cGVzW3RyYW5zZm9ybWVkVHlwZV0gPSBbdHlwZV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHR5cGVzOwogICAgICAgIH0sCiAgICAgICAgZ2V0Q2F0ZWdvcnlEZXRhaWxzKHByZXBvc2l0aW9uLCBsYWJlbCwgbWVzc2FnZSkgewogICAgICAgICAgICByZXR1cm4gbmV3IENhdGVnb3J5RGV0YWlscyhwcmVwb3NpdGlvbiwgbGFiZWwsIG1lc3NhZ2UpOwogICAgICAgIH0sCiAgICAgICAgc2Nyb2xsVG9SZXN1bHRzKCkgewogICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBlbCA9IHRoaXMuJHJlZnNbdGhpcy5yZXN1bHRzQW5jaG9yXS4kZWw7CgogICAgICAgICAgICAgICAgaWYoZWwpIHsKICAgICAgICAgICAgICAgICAgICBlbC5zY3JvbGxJbnRvVmlldyh7IHRvcDogJ3Bvc2l0aW9uJywgYmVoYXZpb3I6ICdzbW9vdGgnIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgdXBkYXRlU2VsZWN0ZWRTaW5JZChpbnB1dCkgewogICAgICAgICAgICB0aGlzLnNlbGVjdGVkU2luSWQgPSBnZXRJbmNpZGVudElkKGlucHV0LnRhcmdldC52YWx1ZSk7CiAgICAgICAgICAgIHRoaXMuZ2V0RXZlbnRUeXBlcygpOwogICAgICAgIH0sCiAgICAgICAgZ2V0RGVmYXVsdEV2ZW50RmlsdGVyKGtleSkgewogICAgICAgICAgICByZXR1cm4gbmV3IEV2ZW50RmlsdGVyKGtleSk7CiAgICAgICAgfSwKICAgICAgICBnZXREZWZhdWx0RW50aXR5RmlsdGVyKGtleSkgewogICAgICAgICAgICByZXR1cm4gbmV3IEVudGl0eUZpbHRlcihrZXkpOwogICAgICAgIH0sCiAgICAgICAgZ2V0RmlsdGVyVmFsdWVzKGNsYWltVmFsdWVzLCBmaWx0ZXJLZXksIHN1YkZpbHRlcktleSkgewogICAgICAgICAgICBjb25zdCBmaWx0ZXJWYWx1ZXMgPSBjbGFpbVZhbHVlcy5oYXNPd25Qcm9wZXJ0eShzdWJGaWx0ZXJLZXkpID8gY2xhaW1WYWx1ZXNbc3ViRmlsdGVyS2V5XSA6IGNsYWltVmFsdWVzW2ZpbHRlcktleV07CiAgICAgICAgICAgIGxldCBsYWJlbHMgPSBbXTsKICAgICAgICAgICAgaWYoZmlsdGVyVmFsdWVzKSB7CiAgICAgICAgICAgICAgICBsYWJlbHMgPSBzdWJGaWx0ZXJLZXkuaW5jbHVkZXModGhpcy5DTEFJTUZJTFRFUlMuZXZlbnRSb2xlKSA/IE9iamVjdC5rZXlzKGZpbHRlclZhbHVlcykgOiB0aGlzLmdldFByZXR0eUxhYmVscyhmaWx0ZXJWYWx1ZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBsYWJlbHM7CiAgICAgICAgfSwKICAgICAgICB1cGRhdGVFdmVudFR5cGUoa2V5LCBpbnB1dCkgewogICAgICAgICAgICAvL3VwZGF0ZSB0aGUgZXhpc3RpbmcgZXZlbnQgdHlwZSBmaWx0ZXIKICAgICAgICAgICAgbGV0IGNyZWF0ZUZpbHRlciA9IHtba2V5XSA6IHRoaXMuZ2V0RGVmYXVsdEV2ZW50RmlsdGVyKGtleSl9OwogICAgICAgICAgICB0aGlzLmNsYWltRmlsdGVyc1trZXldID0gey4uLmNyZWF0ZUZpbHRlcltrZXldLCBbJ2V2ZW50VHlwZSddIDogdGhpcy5ldmVudFR5cGVzW2lucHV0XX07CgogICAgICAgICAgICBpZihpbnB1dCkgewogICAgICAgICAgICAgICAgLy91cGRhdGUgcm9sZXMgYW5kIG5hbWVzIGZvciB0aGUgY2xhaW1GaWx0ZXIKICAgICAgICAgICAgICAgIHRoaXMuZ2V0RW50aXR5TmFtZXNGb3JFdmVudChrZXksIG51bGwsIHRoaXMuZXZlbnRUeXBlc1tpbnB1dF0pOwogICAgICAgICAgICAgICAgdGhpcy5nZXRSb2xlT3B0aW9ucyhrZXksIG51bGwsIHRoaXMuZXZlbnRUeXBlc1tpbnB1dF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB1cGRhdGVOYW1lZEVudGl0eShrZXksIGlucHV0KSB7CiAgICAgICAgICAgIC8vdXBkYXRlIHRoZSBleGlzdGluZyBuYW1lZCBlbnRpdHkgZmlsdGVyCiAgICAgICAgICAgIGxldCBjcmVhdGVGaWx0ZXIgPSB7W2tleV0gOiB0aGlzLmdldERlZmF1bHRFbnRpdHlGaWx0ZXIoa2V5KX07CiAgICAgICAgICAgIHRoaXMuY2xhaW1GaWx0ZXJzW2tleV0gPSB7Li4uY3JlYXRlRmlsdGVyW2tleV0sIFsnbmFtZWRFbnRpdHknXSA6IHRoaXMubmFtZWRFbnRpdGllc1tpbnB1dF19OwoKICAgICAgICAgICAgaWYoaW5wdXQpIHsKICAgICAgICAgICAgICAgIC8vdXBkYXRlIHJvbGVzIGFuZCBldmVudCB0eXBlcyBmb3IgdGhlIGNsYWltRmlsdGVyCiAgICAgICAgICAgICAgICB0aGlzLmdldEV2ZW50VHlwZXNGb3JOYW1lZEVudGl0eShrZXksIG51bGwsIHRoaXMubmFtZWRFbnRpdGllc1tpbnB1dF0pOwogICAgICAgICAgICAgICAgdGhpcy5nZXRSb2xlT3B0aW9ucyhrZXksIG51bGwsIG51bGwsIHRoaXMubmFtZWRFbnRpdGllc1tpbnB1dF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB1cGRhdGVDYXRlZ29yeVJvbGVWYWx1ZShmaWx0ZXJLZXksIHN1YkZpbHRlcktleSwgdmFsdWVUeXBlLCB2YWx1ZSkgewogICAgICAgICAgICBsZXQgY29udmVydGVkVmFsdWUgPSAnJzsKICAgICAgICAgICAgaWYodmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmKHZhbHVlVHlwZSA9PT0gQ0xBSU1GSUxURVJTLnJvbGUpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJ0ZWRWYWx1ZSA9IHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0ucm9sZXMuaGFzT3duUHJvcGVydHkoc3ViRmlsdGVyS2V5KSA/IHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0ucm9sZXNbc3ViRmlsdGVyS2V5XVt2YWx1ZV0gOiB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLnJvbGVzW2ZpbHRlcktleV1bdmFsdWVdOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLmV2ZW50VHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEVudGl0eU5hbWVzRm9yRXZlbnQoZmlsdGVyS2V5LCBzdWJGaWx0ZXJLZXksIHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0uZXZlbnRUeXBlLCBjb252ZXJ0ZWRWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLm5hbWVkRW50aXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0RXZlbnRUeXBlc0Zvck5hbWVkRW50aXR5KGZpbHRlcktleSwgc3ViRmlsdGVyS2V5LCB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLm5hbWVkRW50aXR5LCBjb252ZXJ0ZWRWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZih2YWx1ZVR5cGUgPT09IENMQUlNRklMVEVSUy5ldmVudFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJ0ZWRWYWx1ZSA9IHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0uZXZlbnRzLmhhc093blByb3BlcnR5KHN1YkZpbHRlcktleSkgPyB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLmV2ZW50c1tzdWJGaWx0ZXJLZXldW3ZhbHVlXSA6IHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0uZXZlbnRzW2ZpbHRlcktleV1bdmFsdWVdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Um9sZU9wdGlvbnMoZmlsdGVyS2V5LCBzdWJGaWx0ZXJLZXksIGNvbnZlcnRlZFZhbHVlLCB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLm5hbWVkRW50aXR5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYodmFsdWVUeXBlID09PSBDTEFJTUZJTFRFUlMuYXJndW1lbnRJZHMpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJ0ZWRWYWx1ZSA9IHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0ubmFtZXMuaGFzT3duUHJvcGVydHkoc3ViRmlsdGVyS2V5KSA/IHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0ubmFtZXNbc3ViRmlsdGVyS2V5XVt2YWx1ZV0gOiB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLm5hbWVzW2ZpbHRlcktleV1bdmFsdWVdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Um9sZU9wdGlvbnMoZmlsdGVyS2V5LCBzdWJGaWx0ZXJLZXksIHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0uZXZlbnRUeXBlLCBjb252ZXJ0ZWRWYWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmNsYWltRmlsdGVycyA9IHsuLi50aGlzLmNsYWltRmlsdGVyc307CiAgICAgICAgICAgICAgICBpZih2YWx1ZVR5cGUgPT09IENMQUlNRklMVEVSUy5yb2xlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0uZXZlbnRUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLm5hbWVzW3N1YkZpbHRlcktleV07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLm5hbWVkRW50aXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLmV2ZW50c1tzdWJGaWx0ZXJLZXldOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYodmFsdWVUeXBlID09PSBDTEFJTUZJTFRFUlMuZXZlbnRUeXBlIHx8IHZhbHVlVHlwZSA9PT0gQ0xBSU1GSUxURVJTLmFyZ3VtZW50SWRzKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0ucm9sZXNbc3ViRmlsdGVyS2V5XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy91cGRhdGUgY3VycmVudCBhcmd1bWVudHMgb3IgYWRkIGEgbmV3IGFyZ3VtZW50CiAgICAgICAgICAgIGlmKHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0uYXJndW1lbnRzLmhhc093blByb3BlcnR5KHN1YkZpbHRlcktleSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGaWx0ZXIgPSB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLmFyZ3VtZW50c1tzdWJGaWx0ZXJLZXldOwogICAgICAgICAgICAgICAgY3VycmVudEZpbHRlclt2YWx1ZVR5cGVdID0gY29udmVydGVkVmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLmFyZ3VtZW50c1tzdWJGaWx0ZXJLZXldID0ge1t2YWx1ZVR5cGVdIDogY29udmVydGVkVmFsdWV9OwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkZWxldGVRdWVyeShmaWx0ZXJLZXksIHN1YkZpbHRlcktleSkgewogICAgICAgICAgICAvL2lmIG5vIHN1YmZpbHRlciBrZXkgZGVsZXRlIHRoZSBwYXJlbnQgZmlsdGVyCiAgICAgICAgICAgIGlmKCFzdWJGaWx0ZXJLZXkpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2xhaW1GaWx0ZXJzID0gey4uLnRoaXMuY2xhaW1GaWx0ZXJzfTsKICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgeyAvL2lmIHN1YmZpbHRlciBrZXksIGRlbGV0ZSBhbGwgc3ViZmlsdGVyIHBhcnRzIGZyb20gZmlsdGVyCiAgICAgICAgICAgICAgICB0aGlzLmNsYWltRmlsdGVycyA9IHsuLi50aGlzLmNsYWltRmlsdGVyc307CiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5hcmd1bWVudHNbc3ViRmlsdGVyS2V5XTsKICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLnJvbGVzW3N1YkZpbHRlcktleV07CiAgICAgICAgICAgICAgICBpZih0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLmZpbHRlclR5cGUgPT09IENMQUlNRklMVEVSUy5ldmVudCkgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLm5hbWVzW3N1YkZpbHRlcktleV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmKHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0uZmlsdGVyVHlwZSA9PT0gQ0xBSU1GSUxURVJTLmVudGl0eSkgewogICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5ldmVudHNbc3ViRmlsdGVyS2V5XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0uY29uZGl0aW9uQ291bnQgLS07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKHRoaXMuY2xhaW1GaWx0ZXJzKS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0FkZFRvU2VhcmNoQnV0dG9ucyA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5zaG93U2VhcmNoQnV0dG9ucyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHVwZGF0ZVNlYXJjaEZvcm0odmlld1R5cGUsIGtleSkgewogICAgICAgICAgICBpZih2aWV3VHlwZSA9PT0gdGhpcy52aWV3cy5yZXNldFF1ZXJ5LnR5cGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNhdmVTaW5JZCA9IHRoaXMuc2VsZWN0ZWRTaW5JZDsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy4kZGF0YSwgaW5pdGlhbFN0YXRlKCkpOwogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFNpbklkID0gc2F2ZVNpbklkOwogICAgICAgICAgICAgICAgdGhpcy5nZXRFdmVudFR5cGVzKCk7CiAgICAgICAgICAgICAgICB0aGlzLmdldEVudGl0eU5hbWVzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZih2aWV3VHlwZSA9PT0gdGhpcy52aWV3cy5ldmVudFF1ZXJ5LnR5cGUgfHwgdmlld1R5cGUgPT09IHRoaXMudmlld3MubmFtZWRFbnRpdHlRdWVyeS50eXBlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dTZWFyY2hCdXR0b25zID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dBZGRUb1NlYXJjaEJ1dHRvbnMgPSB0cnVlOwoKICAgICAgICAgICAgICAgIC8vY3JlYXRlIGEgbmV3IGZpbHRlcklEIGFuZCBhIG5ldyBmaWx0ZXIKICAgICAgICAgICAgICAgIGNvbnN0IGZpbHRlcktleSA9IHRoaXMuQ0xBSU1GSUxURVJTLnBhcmVudEZpbHRlciArIHRoaXMucXVlcnlLZXk7CiAgICAgICAgICAgICAgICBpZighdGhpcy5jbGFpbUZpbHRlcnMuaGFzT3duUHJvcGVydHkoZmlsdGVyS2V5KSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhaW1GaWx0ZXJzID0gey4uLnRoaXMuY2xhaW1GaWx0ZXJzLCBbZmlsdGVyS2V5XSA6CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdUeXBlID09PSB0aGlzLnZpZXdzLmV2ZW50UXVlcnkudHlwZSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldERlZmF1bHRFdmVudEZpbHRlcihmaWx0ZXJLZXkpIDogdGhpcy5nZXREZWZhdWx0RW50aXR5RmlsdGVyKGZpbHRlcktleSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5S2V5ICsrOwoKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdmlldyBpbiB0aGlzLnZpZXdzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3c1t2aWV3XS5kaXNhYmxlZCA9IHZpZXcgIT09IHRoaXMudmlld3Muc3RhcnRRdWVyeS50eXBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYodmlld1R5cGUgPT09IHRoaXMudmlld3MuY2F0ZWdvcnlBZGRBcmd1bWVudC50eXBlICYmIGtleSkgewogICAgICAgICAgICAgICAgLy9Pbmx5IGFkZCBzdWJmaWx0ZXJzIGlmIGV2ZW50IHR5cGUgb3IgbmFtZWQgZW50aXR5IGhhcyBhIHZhbHVlCiAgICAgICAgICAgICAgICBpZigodGhpcy5jbGFpbUZpbHRlcnNba2V5XS5maWx0ZXJUeXBlID09PSBDTEFJTUZJTFRFUlMuZXZlbnQgJiYgdGhpcy5jbGFpbUZpbHRlcnNba2V5XS5ldmVudFR5cGUubGVuZ3RoICE9PSAwKSB8fAogICAgICAgICAgICAgICAgICAgICh0aGlzLmNsYWltRmlsdGVyc1trZXldLmZpbHRlclR5cGUgPT09IENMQUlNRklMVEVSUy5lbnRpdHkgJiYgdGhpcy5jbGFpbUZpbHRlcnNba2V5XS5uYW1lZEVudGl0eS5sZW5ndGggIT09IDApKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhaW1GaWx0ZXJzW2tleV0uY29uZGl0aW9uQ291bnQgKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZih2aWV3VHlwZSA9PT0gdGhpcy52aWV3cy5jbGFpbVJlc3VsdHMudHlwZSkgewogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTaW5TZWxlY3Rpb24oe1tUQUJMRUZJRUxETUFQUElORy5zaW5MaXN0XTogW3RoaXMuc2VsZWN0ZWRTaW5JZF19KTsKICAgICAgICAgICAgICAgIHRoaXMudmlld3Nbdmlld1R5cGVdLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmZvcm1hdHRlZEZpbHRlcnMgPSB0aGlzLmZvcm1hdENsYWltRmlsdGVycygpOwogICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxUb1Jlc3VsdHMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZmluZFJvbGVzQW5kRW50aXRpZXNGb3JFdmVudFR5cGUoYXJndW1lbnQsIGV2ZW50VHlwZSkgewogICAgICAgICAgICBsZXQgYXJndW1lbnRPYmplY3QgPSB7fTsKICAgICAgICAgICAgaWYoYXJndW1lbnQucm9sZSkgewogICAgICAgICAgICAgICAgbGV0IGFyZ1JvbGUgPSBhcmd1bWVudC5yb2xlLmZpbmQocm9sZSA9PiByb2xlLmluY2x1ZGVzKGV2ZW50VHlwZSkpOwogICAgICAgICAgICAgICAgaWYoYXJnUm9sZSkgewogICAgICAgICAgICAgICAgICAgIC8vYWRkIHJvbGUgYW5kIG9ubHkgYWRkIGlkcyBpZiB0aGUgcmVzcGVjdGl2ZSByb2xlIGlzIGZvdW5kCiAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRPYmplY3RbJ3JvbGUnXSA9IGFyZ1JvbGU7CiAgICAgICAgICAgICAgICAgICAgaWYoYXJndW1lbnQuaWRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50T2JqZWN0WydpZHMnXSA9IGFyZ3VtZW50LmlkczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gICAvL2lmIGlkcyBhbmQgbm8gcm9sZXMsIGFkZCBpZHMgdG8gdGhlIGZpbHRlcgogICAgICAgICAgICBlbHNlIGlmKGFyZ3VtZW50LmlkcykgewogICAgICAgICAgICAgICAgYXJndW1lbnRPYmplY3RbJ2lkcyddID0gYXJndW1lbnQuaWRzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhcmd1bWVudE9iamVjdDsKICAgICAgICB9LAogICAgICAgIGZvcm1hdENsYWltRmlsdGVycygpIHsKICAgICAgICAgICAgbGV0IGZvcm1hdHRlZEZpbHRlcnMgPSBbXTsKICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLmNsYWltRmlsdGVycykubWFwKGZpbHRlciA9PiB7CiAgICAgICAgICAgICAgICAvLy9IYW5kbGVzIGZvcm1hdHRpbmcgZm9yIHRoZSBFdmVudCBUeXBlcyBxdWVyeSBmb3IgbXVsdGlwbGUgZXZlbnQgdHlwZXMKICAgICAgICAgICAgICAgIGlmKGZpbHRlci5ldmVudFR5cGUgJiYgZmlsdGVyLmV2ZW50VHlwZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yKGNvbnN0IGVUeXBlIG9mIGZpbHRlci5ldmVudFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlZm9ybWF0ID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgZXZlbnQgdHlwZSBmaWx0ZXIgaGFzIGFyZ3VtZW50cywgbG9vcCB0aHJvdWdoIHRoZSBhcmd1bWVudHMgdG8gY29sbGVjdCB0aGUgcmVzcGVjdGl2ZSByb2xlIGFuZCBpZHMKICAgICAgICAgICAgICAgICAgICAgICAgaWYoT2JqZWN0LnZhbHVlcyhmaWx0ZXIuYXJndW1lbnRzKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoY29uc3QgYXJndW1lbnQgb2YgT2JqZWN0LnZhbHVlcyhmaWx0ZXIuYXJndW1lbnRzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFyZ3VtZW50T2JqZWN0ID0gdGhpcy5maW5kUm9sZXNBbmRFbnRpdGllc0ZvckV2ZW50VHlwZShhcmd1bWVudCwgZVR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKGFyZ3VtZW50T2JqZWN0KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZm9ybWF0WydldmVudFR5cGUnXSA9IGVUeXBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVmb3JtYXQuaGFzT3duUHJvcGVydHkoJ2FyZ3VtZW50cycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZvcm1hdFsnYXJndW1lbnRzJ10ucHVzaChhcmd1bWVudE9iamVjdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZm9ybWF0Wydhcmd1bWVudHMnXSA9IFthcmd1bWVudE9iamVjdF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSBhcmUgbm8gYXJndW1lbnRzLCBqdXN0IGFkZCB0aGUgZXZlbnQgdHlwZSB0byB0aGUgZmlsdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmb3JtYXRbJ2V2ZW50VHlwZSddID0gZVR5cGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKHJlZm9ybWF0KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRGaWx0ZXJzLnB1c2gocmVmb3JtYXQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfS8vSGFuZGxlcyBmb3JtYXR0aW5nIGZvciB0aGUgTmFtZWQgRW50aXR5IHF1ZXJ5IGhhdmluZyBhcmd1bWVudHMgdGhhdCBwb3NzaWJseSBjb250YWluIG11bHRpcGxlIGV2ZW50IHR5cGVzIGFuZC9vciBtdWx0aXBsZSByb2xlcwogICAgICAgICAgICAgICAgZWxzZSBpZihPYmplY3QudmFsdWVzKGZpbHRlci5hcmd1bWVudHMpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBsZXQgYWRkTmFtZWRFbnRpdGllcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYXJndW1lbnQgb2YgT2JqZWN0LnZhbHVlcyhmaWx0ZXIuYXJndW1lbnRzKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZihhcmd1bWVudC5ldmVudFR5cGUgJiYgYXJndW1lbnQuZXZlbnRUeXBlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgdGhlcmUgYXJlIG11bHRpcGxlIGV2ZW50IHR5cGVzIGFzIGFuIGFyZ3VtZW50LCBmaW5kIHRoZSByZXNwZWN0aXZlIHJvbGVzIGFuZCBlbnRpdGllcyBhbmQgYWRkIGFzIHNlcGFyYXRlIGFyZ3VtZW50IG9iamVjdHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZVR5cGUgb2YgYXJndW1lbnQuZXZlbnRUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlZm9ybWF0ID0ge1snZXZlbnRUeXBlJ106IGVUeXBlfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb2xlQXJndW1lbnQgPSB0aGlzLmZpbmRSb2xlc0FuZEVudGl0aWVzRm9yRXZlbnRUeXBlKGFyZ3VtZW50LCBlVHlwZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJvbGVBcmd1bWVudC5yb2xlICYmIGZpbHRlci5uYW1lZEVudGl0eSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xlQXJndW1lbnRbJ2lkcyddID0gZmlsdGVyLm5hbWVkRW50aXR5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZvcm1hdFsnYXJndW1lbnRzJ10gPSBbcm9sZUFyZ3VtZW50XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihmaWx0ZXIubmFtZWRFbnRpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmb3JtYXRbJ2FyZ3VtZW50cyddID0gW3tbJ2lkcyddOiBmaWx0ZXIubmFtZWRFbnRpdHl9XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZEZpbHRlcnMucHVzaChyZWZvcm1hdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYXJndW1lbnQucm9sZSAmJiBhcmd1bWVudC5yb2xlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgdGhlcmUgYXJlIG11bHRpcGxlIHJvbGVzIGFzIGFuIGFyZ3VtZW50LCBhZGQgYXMgc2VwYXJhdGUgYXJndW1lbnQgb2JqZWN0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBhcmdSb2xlIG9mIGFyZ3VtZW50LnJvbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVmb3JtYXQgPSB7J2FyZ3VtZW50cycgOiBbXX07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFyZ3VtZW50T2JqZWN0ID0ge307CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudC5ldmVudFR5cGUgfHwgZmlsdGVyLmV2ZW50VHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZvcm1hdFsnZXZlbnRUeXBlJ10gPSBmaWx0ZXIuZXZlbnRUeXBlID8gZmlsdGVyLmV2ZW50VHlwZVswXSA6IGFyZ3VtZW50LmV2ZW50VHlwZVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9JZiB0aGVyZSBpcyBhbiBldmVudCwgb25seSBhZGQgcm9sZXMgdGhhdCBjb3JyZXNwb25kIHdpdGggdGhlIGV2ZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCByb2xlID0gYXJnUm9sZS5pbmNsdWRlcyhyZWZvcm1hdFsnZXZlbnRUeXBlJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyb2xlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudE9iamVjdFsncm9sZSddID0gYXJnUm9sZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRPYmplY3RbJ3JvbGUnXSA9IGFyZ1JvbGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoYXJndW1lbnRPYmplY3QpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50LmlkcyB8fCBmaWx0ZXIubmFtZWRFbnRpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50T2JqZWN0WydpZHMnXSA9IGZpbHRlci5uYW1lZEVudGl0eSA/IGZpbHRlci5uYW1lZEVudGl0eSA6IGFyZ3VtZW50LmlkczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZm9ybWF0Wydhcmd1bWVudHMnXSA9IFthcmd1bWVudE9iamVjdF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRGaWx0ZXJzLnB1c2gocmVmb3JtYXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfS8vSWYgdGhlcmUgYXJlIGFyZ3VtZW50cyBjb250YWluaW5nIGVtcHR5IGV2ZW50IHR5cGVzIG9yIGVtcHR5IHJvbGVzLCB0aGVuIHRoZSBuYW1lZEVudGl0aWVzIGFyZSB0aGUgb25seSB0aGluZ3MgdGhhdCBuZWVkIHRvIGJlIGFkZGVkIHRvIHRoZSBmaWx0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZE5hbWVkRW50aXRpZXMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZihhZGROYW1lZEVudGl0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZWZvcm1hdCA9IHtbJ2FyZ3VtZW50cyddIDogW3snaWRzJyA6IGZpbHRlci5uYW1lZEVudGl0eX1dfTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkRmlsdGVycy5wdXNoKHJlZm9ybWF0KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfS8vSGFuZGxlcyBpZiBhIG5hbWVkIGVudGl0eSBpcyBzZWxlY3RlZCB3aXRoIG5vIGFyZ3VtZW50cwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHJlZm9ybWF0ID0ge307CiAgICAgICAgICAgICAgICAgICAgLy9jYXB0dXJlIHRoZSBzaW5nbGUgZXZlbnQgdHlwZSBpbiB0aGUgYXJyYXkKICAgICAgICAgICAgICAgICAgICBpZihmaWx0ZXIuZXZlbnRUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZm9ybWF0WydldmVudFR5cGUnXSA9IGZpbHRlci5ldmVudFR5cGVbMF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKGZpbHRlci5uYW1lZEVudGl0eSkgewogICAgICAgICAgICAgICAgICAgICAgICByZWZvcm1hdFsnYXJndW1lbnRzJ10gPSBbeydpZHMnIDogZmlsdGVyLm5hbWVkRW50aXR5fV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKHJlZm9ybWF0KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZEZpbHRlcnMucHVzaChyZWZvcm1hdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlZEZpbHRlcnM7CiAgICAgICAgfSwKICAgICAgICBnZXRFdmVudFR5cGVzRm9yTmFtZWRFbnRpdHkoZmlsdGVyS2V5LCBzdWJGaWx0ZXJLZXksIG5hbWVkRW50aXRpZXMsIHJvbGVzKSB7CiAgICAgICAgICAgIGNvbnN0IHJvbGVzRXhpc3QgPSByb2xlcyA/IHJvbGVzIDogbnVsbDsKICAgICAgICAgICAgdGhpcy5nZXRFdmVudFR5cGVzKGZpbHRlcktleSwgc3ViRmlsdGVyS2V5LCBuYW1lZEVudGl0aWVzLCByb2xlc0V4aXN0KTsKCiAgICAgICAgfSwKICAgICAgICBnZXRFdmVudFR5cGVzKGZpbHRlcktleSwgc3ViRmlsdGVyS2V5ID0gJycsIG5hbWVkRW50aXRpZXMgPSBbXSwgcm9sZXMgPSBbXSkgewogICAgICAgICAgICBBUEkuZ2V0U2luRXZlbnRUeXBlcyh0aGlzLnNlbGVjdGVkU2luSWQsIG5hbWVkRW50aXRpZXMsIHJvbGVzKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgICAgICAgICBpZihmaWx0ZXJLZXkgJiYgdGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5oYXNPd25Qcm9wZXJ0eSgnbmFtZWRFbnRpdHknKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBldmVudEtleSA9IHN1YkZpbHRlcktleSA/IHN1YkZpbHRlcktleSA6IGZpbHRlcktleTsKICAgICAgICAgICAgICAgICAgICAgICAgLy9Vc2Ugc3ByZWFkIG9wZXJhdG9yIHRvIGluc3VyZSBuZXN0ZWQgY2hhbmdlcyBhcmUgcGlja2VkIHVwIGJ5IGNvbXB1dGVkQ2xhaW1zIHByb3BlcnR5CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0uZXZlbnRzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5ldmVudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZXZlbnRLZXldOiB0aGlzLnRyYW5zZm9ybUV2ZW50VHlwZXMocmVzcG9uc2UuZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZighZmlsdGVyS2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVlcnlFdmVudFR5cGVzID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGVycm9yKQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGdldEVudGl0eU5hbWVzRm9yRXZlbnQoZmlsdGVyS2V5LCBzdWJGaWx0ZXJLZXksIGV2ZW50VHlwZXMsIHJvbGVzKSB7CiAgICAgICAgICAgIGNvbnN0IHJvbGVzRXhpc3QgPSByb2xlcyA/IHJvbGVzIDogbnVsbDsKICAgICAgICAgICAgbGV0IGZpbHRlclR5cGVzID0gW107CiAgICAgICAgICAgIC8vaWYgcm9sZXMgZXhpc3QsIG9ubHkgcXVlcnkgZm9yIHRoZSBldmVudCB0eXBlcyB0aGF0IGNvcnJlc3BvbmQgd2l0aCB0aGUgZXhpc3Rpbmcgcm9sZXMuCiAgICAgICAgICAgIGlmKHJvbGVzRXhpc3QpIHsKICAgICAgICAgICAgICAgIGZvcihjb25zdCByIG9mIHJvbGVzKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yKGNvbnN0IGUgb2YgZXZlbnRUeXBlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZihyLmluY2x1ZGVzKGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlcy5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZ2V0RW50aXR5TmFtZXMoZmlsdGVyS2V5LCBzdWJGaWx0ZXJLZXksIGZpbHRlclR5cGVzLmxlbmd0aCA+IDAgPyBmaWx0ZXJUeXBlcyA6IGV2ZW50VHlwZXMsIHJvbGVzRXhpc3QpOwogICAgICAgIH0sCiAgICAgICAgZ2V0RW50aXR5TmFtZXMoZmlsdGVyS2V5LCBzdWJGaWx0ZXJLZXkgPSAnJywgZXZlbnRUeXBlcyA9IFtdLCByb2xlcyA9IFtdKSB7CiAgICAgICAgICAgIHJldHVybiBBUEkuZ2V0U2luRW50aXR5TmFtZXModGhpcy5zZWxlY3RlZFNpbklkLCBldmVudFR5cGVzLCByb2xlcykudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLmxlbmd0aCA+IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG5hbWVzID0ge307CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9yZW1vdmVzIGFueSBlbXB0eSBzdHJpbmdzIGZyb20gdGhlIGF1dG9jb21wbGV0ZSBkcm9wZG93bgogICAgICAgICAgICAgICAgICAgICAgICBpZihkLm5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzW2QubmFtZV0gPSBkLmVudGl0aWVzOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZihmaWx0ZXJLZXkgJiYgdGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5oYXNPd25Qcm9wZXJ0eSgnZXZlbnRUeXBlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZUtleSA9IHN1YkZpbHRlcktleSA/IHN1YkZpbHRlcktleSA6IGZpbHRlcktleTsKICAgICAgICAgICAgICAgICAgICAgICAgLy9Vc2Ugc3ByZWFkIG9wZXJhdG9yIHRvIGluc3VyZSBuZXN0ZWQgY2hhbmdlcyBhcmUgcGlja2VkIHVwIGJ5IGNvbXB1dGVkQ2xhaW1zIHByb3BlcnR5CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0ubmFtZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLm5hbWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgW25hbWVLZXldOiBuYW1lcwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKCFmaWx0ZXJLZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeU5hbWVkRW50aXRpZXMgPSBuYW1lczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGVycm9yKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBnZXRSb2xlT3B0aW9ucyhmaWx0ZXJLZXksIHN1YkZpbHRlcktleSwgZXZlbnRUeXBlcywgaWRzKSB7CiAgICAgICAgICAgIGNvbnN0IGlkc0NoZWNrID0gQXJyYXkuaXNBcnJheShpZHMpID8gaWRzIDogbnVsbDsKICAgICAgICAgICAgY29uc3QgbmFtZUtleSA9IHN1YkZpbHRlcktleSA/IHN1YkZpbHRlcktleSA6IGZpbHRlcktleTsKICAgICAgICAgICAgcmV0dXJuIEFQSS5nZXRTaW5Sb2xlcyh0aGlzLnNlbGVjdGVkU2luSWQsIGV2ZW50VHlwZXMsIGlkc0NoZWNrKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAvL3JvbGUgVVJJcyB3aWxsIGJlIGdyb3VwZWQgYnkgdGhlIHRydW5jYXRlZCByb2xlIG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJ1bmNSb2xlID0gZ2V0Um9sZShkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5yb2xlcy5oYXNPd25Qcm9wZXJ0eShuYW1lS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5yb2xlc1tuYW1lS2V5XS5oYXNPd25Qcm9wZXJ0eSh0cnVuY1JvbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9Vc2Ugc3ByZWFkIG9wZXJhdG9yIHRvIGluc3VyZSBuZXN0ZWQgY2hhbmdlcyBhcmUgcGlja2VkIHVwIGJ5IGNvbXB1dGVkQ2xhaW1zIHByb3BlcnR5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5yb2xlcyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5yb2xlcywgW25hbWVLZXldIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsuLi50aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLnJvbGVzW25hbWVLZXldLCBbdHJ1bmNSb2xlXSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsuLi50aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLnJvbGVzW25hbWVLZXldW3RydW5jUm9sZV0sIGRdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5yb2xlcyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5yb2xlcywgW25hbWVLZXldIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey4uLnRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0ucm9sZXNbbmFtZUtleV0sIFt0cnVuY1JvbGVdIDogW2RdfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCByb2xlT2JqZWN0ID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xlT2JqZWN0W3RydW5jUm9sZV0gPSBbZF0gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5yb2xlcyA9IHsuLi50aGlzLmNsYWltRmlsdGVyc1tmaWx0ZXJLZXldLnJvbGVzLCBbbmFtZUtleV0gOiByb2xlT2JqZWN0fTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhaW1GaWx0ZXJzW2ZpbHRlcktleV0ucm9sZXMgPSB7Li4udGhpcy5jbGFpbUZpbHRlcnNbZmlsdGVyS2V5XS5yb2xlcywgW25hbWVLZXldIDogW119OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihlcnJvcik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KfQo="},{"version":3,"sources":["ClaimSearch.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ClaimSearch.vue","sourceRoot":"src/views/eval","sourcesContent":["<!--\n  - Copyright 2021 Next Century Corporation/CACI\n  -\n  - Licensed under the Apache License, Version 2.0 (the \"License\");\n  - you may not use this file except in compliance with the License.\n  - You may obtain a copy of the License at\n  -\n  -       http://www.apache.org/licenses/LICENSE-2.0\n  -\n  - Unless required by applicable law or agreed to in writing, software\n  - distributed under the License is distributed on an \"AS IS\" BASIS,\n  - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  - See the License for the specific language governing permissions and\n  - limitations under the License.\n  -\n  - Created by s.nordt on 6/23/21\n-->\n\n<template>\n    <div class=\"page-content\">\n        <div class=\"kb-details\">\n            <div class=\"kb-description-wrapper\">\n                <div class=\"element-list-header\">\n                    <div class=\"primary-page-header-left\">Claim Search</div>\n                    <div class=\"page-header-right\">\n                        <button id=\"compare_button\" class=\"dark-app-button\" @click=\"linkToEvalDocSearch()\">\n                            <v-icon class=\"button-icon\">mdi-file-document-box-search-outline</v-icon>\n                            Document Search\n                        </button>\n                    </div>\n                </div>\n                <span class=\"element-list-header\">Begin query by selecting an incident. To limit the results returned, add an event type or named entity:</span>\n                <div class=\"query-div\">\n                    <div class=\"initial-query-wrapper\">\n                        <div class=\"query-topic-wrapper\">\n                            <label>Known Incidents</label>\n                            <SelectDropdown :options=\"sinIds\"\n                                            :selectDisplay=\"selectDisplay\"\n                                            :selectedOption=\"sinIds[0]\"\n                                            @selectDropdownChange=\"updateSelectedSinId($event)\">\n                            </SelectDropdown>\n                        </div>\n                        <div v-if=\"showSearchButtons\" class=\"pad-vertically\">\n                            <button class=\"dark-teal-submit-button\" @click.prevent=\"updateSearchForm(views.eventQuery.type)\">Add Event Type</button>\n                            <button class=\"dark-teal-submit-button\" @click.prevent=\"updateSearchForm(views.namedEntityQuery.type)\">Add Named Entity</button>\n                        </div>\n                    </div>\n                    <div v-if=\"!views.startQuery.disabled\">\n                        <div v-for=\"(queryId, queryIndex) in Object.keys(computedClaims)\" :key=\"queryId\">\n                            <span v-if=\"queryIndex > 0\" class=\"icon-text-label\">OR</span>\n                            <!--Event Type filter display-->\n                            <div v-if=\"computedClaims[queryId].filterType === CLAIMFILTERS.event\" class=\"claim-query-wrapper\">\n                                <div class=\"claim-query-input-wrapper\">\n                                    <div class=\"filter-row-label\">\n                                        <label>Event Type</label>\n                                    </div>\n                                    <div class=\"filter-row\">\n                                        <div class=\"query-field-wrapper\">\n                                            <div class=\"autocomplete-input\">\n                                                <AutoComplete class=\"filter-input\"\n                                                        :items=\"getPrettyLabels(eventTypes)\"\n                                                        :required=\"true\"\n                                                        :placeholder=\"'Search by Event Type'\"\n                                                        @autoCompleteSubmission=\"updateEventType(queryId, $event)\"\n                                                ></AutoComplete>\n                                            </div>\n                                        </div>\n                                        <button class=\"dark-icon-button\" @click.prevent=\"deleteQuery(queryId)\">\n                                            <v-icon>mdi-trash-can-outline</v-icon>\n                                        </button>\n                                    </div>\n                                </div>\n                                <div class=\"claim-query-add-wrapper\">\n                                    <div v-if=\"computedClaims[queryId]\" class=\"filter-row\">\n                                        <span v-if=\"computedClaims[queryId].conditionCount > 0\" class=\"icon-text-large\"> & </span>\n                                        <CategoryRoleFilter v-for=\"index in computedClaims[queryId].conditionCount\" :key=\"CLAIMFILTERS.entityRole + index\"\n                                              :categoryDetails=\"getCategoryDetails('AS', 'Entity', 'entity names')\"\n                                              :categoryValues=\"getFilterValues(computedClaims[queryId].names, queryId, CLAIMFILTERS.entityRole + index)\"\n                                              :roleValues=\"getFilterValues(computedClaims[queryId].roles, queryId, CLAIMFILTERS.entityRole + index)\"\n                                              :condition=\"index===1 ? '' : '&'\"\n                                              :conditionClass=\"'icon-text-large'\"\n                                              @categoryValueChange=\"updateCategoryRoleValue(queryId, CLAIMFILTERS.entityRole + index, CLAIMFILTERS.argumentIds, $event)\"\n                                              @roleValueChange=\"updateCategoryRoleValue(queryId, CLAIMFILTERS.entityRole + index, CLAIMFILTERS.role, $event)\"\n                                        ></CategoryRoleFilter>\n                                        <button v-if=\"computedClaims[queryId].conditionCount > 0\" class=\"dark-icon-button\" @click.prevent=\"deleteQuery(queryId, CLAIMFILTERS.entityRole + computedClaims[queryId].conditionCount)\">\n                                            <v-icon>mdi-trash-can-outline</v-icon>\n                                        </button>\n                                    </div>\n                                    <div>\n                                        <button class=\"dark-teal-submit-button\"  v-if=\"!views.startQuery.disabled\"\n                                                @click.prevent=\"updateSearchForm(views.categoryAddArgument.type, queryId)\"\n                                        >\n                                            <v-icon>mdi-plus-circle</v-icon> Add Entity and/or Role\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                            <!--Named Entity filter display-->\n                            <div v-else class=\"claim-query-wrapper\">\n                                <div class=\"claim-query-input-wrapper\">\n                                    <div class=\"filter-row-label\">\n                                        <label>Named Entity</label>\n                                    </div>\n                                    <div class=\"filter-row\">\n                                        <div class=\"query-field-wrapper\">\n                                            <div class=\"autocomplete-input\">\n                                                <AutoComplete class=\"filter-input\"\n                                                              :items=\"getPrettyLabels(namedEntities)\"\n                                                              :required=\"true\"\n                                                              :placeholder=\"'Search by Named Entity'\"\n                                                              @autoCompleteSubmission=\"updateNamedEntity(queryId, $event)\"\n                                                ></AutoComplete>\n                                            </div>\n                                        </div>\n                                        <button class=\"dark-icon-button\" @click.prevent=\"deleteQuery(queryId)\">\n                                            <v-icon>mdi-trash-can-outline</v-icon>\n                                        </button>\n                                    </div>\n                                </div>\n                                <div class=\"claim-query-add-wrapper\">\n                                    <div v-if=\"computedClaims[queryId]\" class=\"filter-row\">\n                                        <span class=\"icon-text-large\" v-if=\"computedClaims[queryId].conditionCount > 0\"> & </span>\n                                        <CategoryRoleFilter v-for=\"index in computedClaims[queryId].conditionCount\" :key=\"CLAIMFILTERS.eventRole + index\"\n                                                          :categoryDetails=\"getCategoryDetails('HAVING  ', 'Event', 'event types')\"\n                                                          :categoryValues=\"getFilterValues(computedClaims[queryId].events, queryId, CLAIMFILTERS.eventRole + index)\"\n                                                          :roleValues=\"getFilterValues(computedClaims[queryId].roles, queryId, CLAIMFILTERS.eventRole + index)\"\n                                                          :condition=\"index===1 ? '' : '&'\"\n                                                          :conditionClass=\"'icon-text-large'\"\n                                                          @categoryValueChange=\"updateCategoryRoleValue(queryId, CLAIMFILTERS.eventRole + index, CLAIMFILTERS.eventType, $event)\"\n                                                          @roleValueChange=\"updateCategoryRoleValue(queryId, CLAIMFILTERS.eventRole + index, CLAIMFILTERS.role, $event)\"\n                                        ></CategoryRoleFilter>\n                                        <button v-if=\"computedClaims[queryId].conditionCount > 0\" class=\"dark-icon-button\" @click.prevent=\"deleteQuery(queryId, CLAIMFILTERS.eventRole + computedClaims[queryId].conditionCount)\">\n                                            <v-icon>mdi-trash-can-outline</v-icon>\n                                        </button>\n                                    </div>\n                                    <div>\n                                        <button class=\"dark-teal-submit-button\"  v-if=\"!views.startQuery.disabled\"\n                                                @click.prevent=\"updateSearchForm(views.categoryAddArgument.type, queryId)\"\n                                        >\n                                            <v-icon>mdi-plus-circle</v-icon> Add Event and/or Role\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                            <hr class=\"hr-light\">\n                        </div>\n                    </div>\n                    <div v-if=\"showAddToSearchButtons\" class=\"kb-description-wrapper\">\n                        <span class=\"pad-vertically\">Add another query condition:</span>\n                        <div  class=\"pad-vertically\">\n                            <button type=\"submit\" class=\"dark-teal-submit-button\" @click.prevent=\"updateSearchForm(views.eventQuery.type)\">Add Event Type</button>\n                            <button type=\"submit\" class=\"dark-teal-submit-button\" @click.prevent=\"updateSearchForm(views.namedEntityQuery.type)\">Add Named Entity</button>\n                        </div>\n                    </div>\n                    <div class=\"footer-button-wrapper\">\n                        <div>\n                            <button type=\"submit\" class=\"dark-gray-submit-button\" @click.prevent=\"updateSearchForm(views.resetQuery.type)\">\n                                Reset\n                            </button>\n                            <button type=\"submit\" ref=\"searchButton\" class=\"dark-teal-submit-button\" @click.prevent=\"updateSearchForm(views.claimResults.type)\">\n                                Search\n                            </button>\n                        </div>\n                        <hr class=\"hr-fade\">\n                    </div>\n                </div>\n            </div>\n        </div>\n        <Claims v-if=\"!views.claimResults.disabled\" :ref=\"resultsAnchor\" :claimSearchSinId=\"selectedSinId\" :claimSearchFilters=\"formattedClaims\" @completedSearch=completedSearch($event) ></Claims>\n    </div>\n</template>\n\n<script>\n    import AutoComplete from '@/components/AutoComplete';\n    import CategoryRoleFilter from '@/components/forms/CategoryRoleFilter';\n    import SelectDropdown from '@/components/SelectDropdown';\n    import Claims from '@/views/analyze/Claims';\n    import CategoryTypes from '@/assets/data/types.json';\n    import {mapMutations} from 'vuex';\n    import {SELECTDISPLAY,\n        TABLEFIELDMAPPING,\n        INCIDENTMAPPING,\n        getTransformedType,\n        getLastSubType,\n        getRole,\n        getIncidentId,\n        sortCaseInsensitive\n    } from '../../utils';\n    import API from '../../api';\n\n    const CLAIMFILTERS = {\n        parentFilter: 'filter',\n        event: 'eventFilter',\n        entity: 'entityFilter',\n        entityRole: 'entityRoleFilter',\n        eventRole: 'eventRoleFilter',\n        //specific to Rest API data formatting\n        argumentIds: 'ids',\n        role: 'role',\n        eventType: 'eventType'\n    };\n\n    class CategoryDetails {\n        constructor (preposition, label, message) {\n            this.preposition = preposition;\n            this.label = label;\n            this.message = message;\n        }\n    }\n\n    class View {\n        constructor (type, disabled) {\n            this.type = type;\n            this.disabled = disabled;\n        }\n    }\n\n    class EventFilter {\n        constructor(id) {\n            this.filterId = id;\n            this.filterType = CLAIMFILTERS.event;\n            this.eventType = [];\n            this.arguments = {};\n            this.conditionCount = 0;\n            this.names = {};\n            this.roles = {};\n        }\n    }\n\n    class EntityFilter {\n        constructor(id) {\n            this.filterId = id;\n            this.filterType = CLAIMFILTERS.entity;\n            this.namedEntity = [];\n            this.arguments = {};\n            this.conditionCount = 0;\n            this.events = {};\n            this.roles = {};\n        }\n    }\n\n    function initialState() {\n        return {\n            selectDisplay: SELECTDISPLAY.input,\n            selectedSinId:'E201',\n            showSearchButtons: true,\n            showAddToSearchButtons: false,\n            claimFilters: {},\n            formattedFilters: {},\n            queryKey: 1,\n            queryEventTypes : [],\n            queryNamedEntities: [],\n            resultsAnchor: 'claim_results',\n            views: {\n                resetQuery: new View('resetQuery', false),\n                startQuery: new View('startQuery', true),\n                eventQuery: new View('eventQuery', true),\n                namedEntityQuery: new View('namedEntityQuery', true),\n                categoryAddArgument :new View('categoryAddArgument', true),\n                claimResults: new View('claimResults', true)\n            }\n        }\n    }\n    export default {\n        name: 'ClaimSearch',\n        components: {AutoComplete, Claims, CategoryRoleFilter, SelectDropdown},\n        data: () => (initialState()),\n        created() {\n            this.CLAIMFILTERS = CLAIMFILTERS;\n            this.INCIDENTMAPPING = INCIDENTMAPPING;\n        },\n        mounted() {\n            window.scroll({\n                top: 0,\n                behavior: 'smooth'\n            });\n            //fetch the query event types and named entities for the selected SIN\n            this.getEventTypes();\n            this.getEntityNames();\n        },\n        computed: {\n           eventTypes() {\n               return this.transformEventTypes(this.queryEventTypes);\n           },\n            namedEntities() {\n               return this.queryNamedEntities;\n            },\n            computedClaims() {\n                return this.claimFilters;\n            },\n            formattedClaims() {\n               return this.formattedFilters;\n            },\n            sinIds() {\n                return INCIDENTMAPPING.map(v => v.value);\n            }\n        },\n        methods: {\n            ...mapMutations(['updateSinSelection']),\n            linkToEvalDocSearch () {\n                window.open('https://blackbox.verdi.nextcentury.com/', '_blank');\n            },\n            completedSearch(value) {\n                this.$refs.searchButton.disabled = !value\n            },\n            getPrettyLabels(items) {\n                //remove duplicates and sort\n               return  Object.keys(items) ? sortCaseInsensitive([...Object.keys(items)]) : items;\n            },\n            transformEventTypes(eventTypes) {\n                let types = {};\n                for (const type of eventTypes) {\n                    const transformedType = getTransformedType(getLastSubType(type), CategoryTypes.eventTypeMapping);\n                    if(types.hasOwnProperty(transformedType)) {\n                        types[transformedType].push(type);\n                    }\n                    else {\n                        types[transformedType] = [type];\n                    }\n                }\n                return types;\n            },\n            getCategoryDetails(preposition, label, message) {\n                return new CategoryDetails(preposition, label, message);\n            },\n            scrollToResults() {\n                this.$nextTick(() => {\n                    const el = this.$refs[this.resultsAnchor].$el;\n\n                    if(el) {\n                        el.scrollIntoView({ top: 'position', behavior: 'smooth' })\n                    }\n                });\n            },\n            updateSelectedSinId(input) {\n                this.selectedSinId = getIncidentId(input.target.value);\n                this.getEventTypes();\n            },\n            getDefaultEventFilter(key) {\n                return new EventFilter(key);\n            },\n            getDefaultEntityFilter(key) {\n                return new EntityFilter(key);\n            },\n            getFilterValues(claimValues, filterKey, subFilterKey) {\n                const filterValues = claimValues.hasOwnProperty(subFilterKey) ? claimValues[subFilterKey] : claimValues[filterKey];\n                let labels = [];\n                if(filterValues) {\n                    labels = subFilterKey.includes(this.CLAIMFILTERS.eventRole) ? Object.keys(filterValues) : this.getPrettyLabels(filterValues);\n                }\n                return labels;\n            },\n            updateEventType(key, input) {\n                //update the existing event type filter\n                let createFilter = {[key] : this.getDefaultEventFilter(key)};\n                this.claimFilters[key] = {...createFilter[key], ['eventType'] : this.eventTypes[input]};\n\n                if(input) {\n                    //update roles and names for the claimFilter\n                    this.getEntityNamesForEvent(key, null, this.eventTypes[input]);\n                    this.getRoleOptions(key, null, this.eventTypes[input]);\n                }\n            },\n            updateNamedEntity(key, input) {\n                //update the existing named entity filter\n                let createFilter = {[key] : this.getDefaultEntityFilter(key)};\n                this.claimFilters[key] = {...createFilter[key], ['namedEntity'] : this.namedEntities[input]};\n\n                if(input) {\n                    //update roles and event types for the claimFilter\n                    this.getEventTypesForNamedEntity(key, null, this.namedEntities[input]);\n                    this.getRoleOptions(key, null, null, this.namedEntities[input]);\n                }\n            },\n            updateCategoryRoleValue(filterKey, subFilterKey, valueType, value) {\n                let convertedValue = '';\n                if(value) {\n                    if(valueType === CLAIMFILTERS.role) {\n                        convertedValue = this.claimFilters[filterKey].roles.hasOwnProperty(subFilterKey) ? this.claimFilters[filterKey].roles[subFilterKey][value] : this.claimFilters[filterKey].roles[filterKey][value];\n                        if (this.claimFilters[filterKey].eventType) {\n                            this.getEntityNamesForEvent(filterKey, subFilterKey, this.claimFilters[filterKey].eventType, convertedValue);\n                        } else if (this.claimFilters[filterKey].namedEntity) {\n                            this.getEventTypesForNamedEntity(filterKey, subFilterKey, this.claimFilters[filterKey].namedEntity, convertedValue);\n                        }\n                    }\n                    else if(valueType === CLAIMFILTERS.eventType) {\n                        convertedValue = this.claimFilters[filterKey].events.hasOwnProperty(subFilterKey) ? this.claimFilters[filterKey].events[subFilterKey][value] : this.claimFilters[filterKey].events[filterKey][value];\n                        this.getRoleOptions(filterKey, subFilterKey, convertedValue, this.claimFilters[filterKey].namedEntity);\n                    }\n                    else if(valueType === CLAIMFILTERS.argumentIds) {\n                        convertedValue = this.claimFilters[filterKey].names.hasOwnProperty(subFilterKey) ? this.claimFilters[filterKey].names[subFilterKey][value] : this.claimFilters[filterKey].names[filterKey][value];\n                        this.getRoleOptions(filterKey, subFilterKey, this.claimFilters[filterKey].eventType, convertedValue);\n                    }\n                }\n                else {\n                    this.claimFilters = {...this.claimFilters};\n                    if(valueType === CLAIMFILTERS.role) {\n                        if (this.claimFilters[filterKey].eventType) {\n                            delete this.claimFilters[filterKey].names[subFilterKey];\n                        } else if (this.claimFilters[filterKey].namedEntity) {\n                            delete this.claimFilters[filterKey].events[subFilterKey];\n                        }\n                    }\n                    else if(valueType === CLAIMFILTERS.eventType || valueType === CLAIMFILTERS.argumentIds) {\n                        delete this.claimFilters[filterKey].roles[subFilterKey];\n                    }\n                }\n\n                //update current arguments or add a new argument\n                if(this.claimFilters[filterKey].arguments.hasOwnProperty(subFilterKey)) {\n                    const currentFilter = this.claimFilters[filterKey].arguments[subFilterKey];\n                    currentFilter[valueType] = convertedValue;\n                }\n                else {\n                    this.claimFilters[filterKey].arguments[subFilterKey] = {[valueType] : convertedValue};\n                }\n            },\n            deleteQuery(filterKey, subFilterKey) {\n                //if no subfilter key delete the parent filter\n                if(!subFilterKey) {\n                    this.claimFilters = {...this.claimFilters};\n                    delete this.claimFilters[filterKey];\n                }\n                else { //if subfilter key, delete all subfilter parts from filter\n                    this.claimFilters = {...this.claimFilters};\n                    delete this.claimFilters[filterKey].arguments[subFilterKey];\n                    delete this.claimFilters[filterKey].roles[subFilterKey];\n                    if(this.claimFilters[filterKey].filterType === CLAIMFILTERS.event) {\n                        delete this.claimFilters[filterKey].names[subFilterKey];\n                    }\n                    else if(this.claimFilters[filterKey].filterType === CLAIMFILTERS.entity) {\n                         delete this.claimFilters[filterKey].events[subFilterKey];\n                    }\n                    this.claimFilters[filterKey].conditionCount --;\n                }\n\n                if(Object.keys(this.claimFilters).length === 0) {\n                    this.showAddToSearchButtons = false;\n                    this.showSearchButtons = true;\n                }\n            },\n            updateSearchForm(viewType, key) {\n                if(viewType === this.views.resetQuery.type) {\n                    const saveSinId = this.selectedSinId;\n                    Object.assign(this.$data, initialState());\n                    this.selectedSinId = saveSinId;\n                    this.getEventTypes();\n                    this.getEntityNames();\n                }\n                else if(viewType === this.views.eventQuery.type || viewType === this.views.namedEntityQuery.type) {\n                    this.showSearchButtons = false;\n                    this.showAddToSearchButtons = true;\n\n                    //create a new filterID and a new filter\n                    const filterKey = this.CLAIMFILTERS.parentFilter + this.queryKey;\n                    if(!this.claimFilters.hasOwnProperty(filterKey)) {\n                        this.claimFilters = {...this.claimFilters, [filterKey] :\n                            viewType === this.views.eventQuery.type ?\n                                this.getDefaultEventFilter(filterKey) : this.getDefaultEntityFilter(filterKey)\n                        }\n                    }\n                    this.queryKey ++;\n\n                    for (const view in this.views) {\n                        this.views[view].disabled = view !== this.views.startQuery.type;\n                    }\n                }\n                else if(viewType === this.views.categoryAddArgument.type && key) {\n                    //Only add subfilters if event type or named entity has a value\n                    if((this.claimFilters[key].filterType === CLAIMFILTERS.event && this.claimFilters[key].eventType.length !== 0) ||\n                        (this.claimFilters[key].filterType === CLAIMFILTERS.entity && this.claimFilters[key].namedEntity.length !== 0))\n                    {\n                        this.claimFilters[key].conditionCount ++;\n                    }\n                }\n                else if(viewType === this.views.claimResults.type) {\n                    this.updateSinSelection({[TABLEFIELDMAPPING.sinList]: [this.selectedSinId]});\n                    this.views[viewType].disabled = false;\n                    this.formattedFilters = this.formatClaimFilters();\n                    this.scrollToResults();\n                }\n            },\n            findRolesAndEntitiesForEventType(argument, eventType) {\n                let argumentObject = {};\n                if(argument.role) {\n                    let argRole = argument.role.find(role => role.includes(eventType));\n                    if(argRole) {\n                        //add role and only add ids if the respective role is found\n                        argumentObject['role'] = argRole;\n                        if(argument.ids) {\n                            argumentObject['ids'] = argument.ids;\n                        }\n                    }\n                }   //if ids and no roles, add ids to the filter\n                else if(argument.ids) {\n                    argumentObject['ids'] = argument.ids;\n                }\n                return argumentObject;\n            },\n            formatClaimFilters() {\n                let formattedFilters = [];\n                Object.values(this.claimFilters).map(filter => {\n                    ///Handles formatting for the Event Types query for multiple event types\n                    if(filter.eventType && filter.eventType.length > 0) {\n                        for(const eType of filter.eventType) {\n                            let reformat = {};\n                            //if event type filter has arguments, loop through the arguments to collect the respective role and ids\n                            if(Object.values(filter.arguments).length > 0) {\n                                for(const argument of Object.values(filter.arguments)) {\n                                    const argumentObject = this.findRolesAndEntitiesForEventType(argument, eType);\n                                    if(Object.keys(argumentObject).length > 0) {\n                                        reformat['eventType'] = eType;\n                                        if (reformat.hasOwnProperty('arguments')) {\n                                            reformat['arguments'].push(argumentObject)\n                                        } else {\n                                            reformat['arguments'] = [argumentObject];\n                                        }\n                                    }\n                                }\n                            }\n                            //if there are no arguments, just add the event type to the filter\n                            else {\n                                reformat['eventType'] = eType;\n                            }\n\n                            if(Object.keys(reformat).length > 0) {\n                                formattedFilters.push(reformat);\n                            }\n                        }\n                    }//Handles formatting for the Named Entity query having arguments that possibly contain multiple event types and/or multiple roles\n                    else if(Object.values(filter.arguments).length > 0) {\n                        let addNamedEntities = false;\n                        for (const argument of Object.values(filter.arguments)) {\n                            if(argument.eventType && argument.eventType.length > 0) {\n                                //If there are multiple event types as an argument, find the respective roles and entities and add as separate argument objects\n                                for (const eType of argument.eventType) {\n                                    let reformat = {['eventType']: eType};\n                                    const roleArgument = this.findRolesAndEntitiesForEventType(argument, eType);\n\n                                    if(roleArgument.role && filter.namedEntity) {\n                                        roleArgument['ids'] = filter.namedEntity;\n                                        reformat['arguments'] = [roleArgument];\n                                    }\n                                    else if(filter.namedEntity) {\n                                        reformat['arguments'] = [{['ids']: filter.namedEntity}];\n                                    }\n\n                                    formattedFilters.push(reformat);\n                                }\n                            }\n                            else if (argument.role && argument.role.length > 0) {\n                                //If there are multiple roles as an argument, add as separate argument objects\n                                for (const argRole of argument.role) {\n                                    let reformat = {'arguments' : []};\n                                    let argumentObject = {};\n\n                                    if (argument.eventType || filter.eventType) {\n                                        reformat['eventType'] = filter.eventType ? filter.eventType[0] : argument.eventType[0];\n                                        //If there is an event, only add roles that correspond with the event\n                                        let role = argRole.includes(reformat['eventType']);\n                                        if(role) {\n                                            argumentObject['role'] = argRole;\n                                        }\n                                    }\n                                    else {\n                                        argumentObject['role'] = argRole;\n                                    }\n\n                                    if (Object.keys(argumentObject).length > 0) {\n                                        if (argument.ids || filter.namedEntity) {\n                                            argumentObject['ids'] = filter.namedEntity ? filter.namedEntity : argument.ids;\n                                            reformat['arguments'] = [argumentObject]\n                                        }\n                                        formattedFilters.push(reformat);\n                                    }\n                                }\n                            }//If there are arguments containing empty event types or empty roles, then the namedEntities are the only things that need to be added to the filter\n                            else{\n                                addNamedEntities = true;\n                            }\n                        }\n\n                        if(addNamedEntities) {\n                            let reformat = {['arguments'] : [{'ids' : filter.namedEntity}]};\n                            formattedFilters.push(reformat);\n                        }\n\n                    }//Handles if a named entity is selected with no arguments\n                    else {\n                        let reformat = {};\n                        //capture the single event type in the array\n                        if(filter.eventType) {\n                            reformat['eventType'] = filter.eventType[0];\n                        }\n                        if(filter.namedEntity) {\n                            reformat['arguments'] = [{'ids' : filter.namedEntity}];\n                        }\n                        if(Object.keys(reformat).length > 0) {\n                            formattedFilters.push(reformat);\n                        }\n                    }\n                });\n                return formattedFilters;\n            },\n            getEventTypesForNamedEntity(filterKey, subFilterKey, namedEntities, roles) {\n                const rolesExist = roles ? roles : null;\n                this.getEventTypes(filterKey, subFilterKey, namedEntities, rolesExist);\n\n            },\n            getEventTypes(filterKey, subFilterKey = '', namedEntities = [], roles = []) {\n                API.getSinEventTypes(this.selectedSinId, namedEntities, roles).then(response => {\n                    if(response.data.length > 0 ) {\n                        if(filterKey && this.claimFilters[filterKey].hasOwnProperty('namedEntity')) {\n                            const eventKey = subFilterKey ? subFilterKey : filterKey;\n                            //Use spread operator to insure nested changes are picked up by computedClaims property\n                            this.claimFilters[filterKey].events = {\n                                ...this.claimFilters[filterKey].events,\n                                [eventKey]: this.transformEventTypes(response.data)\n                            };\n                        }\n                        else if(!filterKey) {\n                            this.queryEventTypes = response.data;\n                        }\n                    }\n                }).catch((error) => {\n                    console.warn(error)\n                });\n            },\n            getEntityNamesForEvent(filterKey, subFilterKey, eventTypes, roles) {\n                const rolesExist = roles ? roles : null;\n                let filterTypes = [];\n                //if roles exist, only query for the event types that correspond with the existing roles.\n                if(rolesExist) {\n                    for(const r of roles) {\n                        for(const e of eventTypes) {\n                            if(r.includes(e)) {\n                                filterTypes.push(e);\n                            }\n                        }\n                    }\n                }\n                this.getEntityNames(filterKey, subFilterKey, filterTypes.length > 0 ? filterTypes : eventTypes, rolesExist);\n            },\n            getEntityNames(filterKey, subFilterKey = '', eventTypes = [], roles = []) {\n                return API.getSinEntityNames(this.selectedSinId, eventTypes, roles).then(response => {\n                    if(response.data.length > 0 ) {\n                        let names = {};\n                        for (const d of response.data) {\n                            //removes any empty strings from the autocomplete dropdown\n                            if(d.name) {\n                                names[d.name] = d.entities;\n                            }\n                        }\n\n                        if(filterKey && this.claimFilters[filterKey].hasOwnProperty('eventType')) {\n                            const nameKey = subFilterKey ? subFilterKey : filterKey;\n                            //Use spread operator to insure nested changes are picked up by computedClaims property\n                            this.claimFilters[filterKey].names = {\n                                ...this.claimFilters[filterKey].names,\n                                [nameKey]: names\n                            };\n                        }\n                        else if(!filterKey) {\n                            this.queryNamedEntities = names;\n                        }\n                    }\n                }).catch((error) => {\n                    console.warn(error);\n                });\n            },\n            getRoleOptions(filterKey, subFilterKey, eventTypes, ids) {\n                const idsCheck = Array.isArray(ids) ? ids : null;\n                const nameKey = subFilterKey ? subFilterKey : filterKey;\n                return API.getSinRoles(this.selectedSinId, eventTypes, idsCheck).then(response => {\n                    if(response.data.length > 0 ) {\n                        for (const d of response.data) {\n                            //role URIs will be grouped by the truncated role name\n                            const truncRole = getRole(d);\n                            if(this.claimFilters[filterKey].roles.hasOwnProperty(nameKey)) {\n                                if(this.claimFilters[filterKey].roles[nameKey].hasOwnProperty(truncRole)) {\n                                    //Use spread operator to insure nested changes are picked up by computedClaims property\n                                    this.claimFilters[filterKey].roles = {\n                                        ...this.claimFilters[filterKey].roles, [nameKey] :\n                                            {...this.claimFilters[filterKey].roles[nameKey], [truncRole] :\n                                                    [...this.claimFilters[filterKey].roles[nameKey][truncRole], d]\n                                            }\n                                    }\n                                }\n                                else {\n                                    this.claimFilters[filterKey].roles = {\n                                        ...this.claimFilters[filterKey].roles, [nameKey] :\n                                        {...this.claimFilters[filterKey].roles[nameKey], [truncRole] : [d]}\n                                    }\n                                }\n                            }\n                            else {\n                                let roleObject = {};\n                                roleObject[truncRole] = [d] ;\n                                this.claimFilters[filterKey].roles = {...this.claimFilters[filterKey].roles, [nameKey] : roleObject};\n                            }\n                        }\n                    }\n                    else {\n                        this.claimFilters[filterKey].roles = {...this.claimFilters[filterKey].roles, [nameKey] : []};\n                    }\n                }).catch((error) => {\n                    console.warn(error);\n                });\n            }\n        }\n    }\n</script>\n\n<style lang=\"scss\" scoped>\n    .query-div {\n        @extend .kb-description-wrapper;\n        justify-content: space-between;\n    }\n\n    .query-topic-wrapper {\n        padding-bottom: 36px;\n    }\n\n    .claim-query-wrapper {\n        @include flex-row-wrap;\n        align-items: flex-end;\n    }\n\n    .claim-query-input-wrapper {\n        @include flex-column-nowrap;\n        padding-bottom: 8px;\n        padding-right: 4px;\n    }\n\n    .claim-query-add-wrapper {\n        @include flex-column-wrap;\n        padding-bottom: 20px;\n        line-height: 30px;\n        width: 100%;\n    }\n\n    .initial-query-wrapper{\n        @include flex-column-nowrap;\n\n        div > label{\n            padding: 0 4px;\n            @extend .bold-text;\n            display: flex;\n            flex-direction: row;\n            align-items: flex-end;\n            justify-content: space-between;\n        }\n    }\n\n    .filter-row{\n        display: flex;\n        flex-flow: row wrap;\n    }\n\n    .filter-row-label {\n        @extend .form-label;\n        @extend .bold-text;\n        font-size: 14px;\n        width: 100%;\n        label {\n            padding: 0 4px;\n        }\n    }\n\n</style>\n\n"]}]}